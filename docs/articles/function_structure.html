<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>STRUCTURE • datazoom.amazonia</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="STRUCTURE">
<meta property="og:description" content="datazoom.amazonia">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">datazoom.amazonia</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ANEEL.html">ANEEL</a>
    </li>
    <li>
      <a href="../articles/BACI.html">BACI</a>
    </li>
    <li>
      <a href="../articles/CEMPRE.html">CEMPRE</a>
    </li>
    <li>
      <a href="../articles/CIPO.html">CIPÓ</a>
    </li>
    <li>
      <a href="../articles/COMEX.html">COMEX</a>
    </li>
    <li>
      <a href="../articles/DATASUS.html">DATASUS</a>
    </li>
    <li>
      <a href="../articles/DEGRAD.html">DEGRAD</a>
    </li>
    <li>
      <a href="../articles/DETER.html">DETER</a>
    </li>
    <li>
      <a href="../articles/EPE.html">EPE</a>
    </li>
    <li>
      <a href="../articles/function_structure.html">STRUCTURE</a>
    </li>
    <li>
      <a href="../articles/GOOGLEDRIVE.html">GOOGLEDRIVE</a>
    </li>
    <li>
      <a href="../articles/IBAMA.html">IBAMA</a>
    </li>
    <li>
      <a href="../articles/IEMA.html">IEMA</a>
    </li>
    <li>
      <a href="../articles/IMAZON.html">IMAZON</a>
    </li>
    <li>
      <a href="../articles/IPS.html">Social Progress Index</a>
    </li>
    <li>
      <a href="../articles/MAPBIOMAS.html">MAPBIOMAS</a>
    </li>
    <li>
      <a href="../articles/municipalities.html">legal_amazon</a>
    </li>
    <li>
      <a href="../articles/PAM.html">PAM</a>
    </li>
    <li>
      <a href="../articles/PEVS.html">PEVS</a>
    </li>
    <li>
      <a href="../articles/PIBMUNIC.html">PIBMUNIC</a>
    </li>
    <li>
      <a href="../articles/POPULATION.html">POPULATION</a>
    </li>
    <li>
      <a href="../articles/PPM.html">PPM</a>
    </li>
    <li>
      <a href="../articles/PRODES.html">PRODES</a>
    </li>
    <li>
      <a href="../articles/SEEG.html">SEEG</a>
    </li>
    <li>
      <a href="../articles/SIGMINE.html">SIGMINE</a>
    </li>
    <li>
      <a href="../articles/TERRACLIMATE.html">TerraClimate</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>STRUCTURE</h1>
            
      
      
      <div class="hidden name"><code>function_structure.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="the-structure-of-the-functions">The Structure of the functions<a class="anchor" aria-label="anchor" href="#the-structure-of-the-functions"></a>
</h2>
<p><strong>1. Bind Global Variables:</strong> The goal is to ensure that
all the variables in the function were initialized to some value. We
also do this to avoid errors when we check the function.</p>
<p><strong>2. Define Basic Parameters:</strong> Create a list with all
the parameters from the function. The list <em>param</em> will be an
organized list with all the parameters of interest.</p>
<p><strong>3. Download Data:</strong> In the majority of our functions,
we download data by using external_download(). However, when we download
data from IBGE, we use a function called sidra_download(). Both of these
functions can be found in the “download.R” file.</p>
<p><strong>4. Data Engineering:</strong> In this section of the code, we
(i) exclude variables that we judge not to be relevant;(ii) sometimes we
change the class of some variables; (iii) sometimes we change data to be
organized in the long format or in the wide format depending on what we
want; (iv) generally speaking, it’s in this part of the code that we
make the most changes in the original Data Frame.</p>
<p><strong>5. Harmonizing Variable Names:</strong> Rename columns with
better names.</p>
<p><strong>6. Load Dictionary:</strong> In the functions that work with
IBGE’s data, we use the function “load_dictionary()”. This function
creates an organized correspondence between the code of each product,
its name, its unit of measure and other attributes.</p>
<p><strong>7. Translation / add variables:</strong> After having
organized the Data Frame, we then translate it. In some functions, the
translation will start in a section called “Labelling” and data from the
“dictionary.R” file will be used. In other functions, you will see the
names of the columns being translated first and then each line of the
original Data Frame will be translated.</p>
<p><strong>8. Return Data Frame:</strong> In the structure of our
functions, you will see <strong>(raw_data == TRUE){return(dat)}</strong>
right after “Downloading Data”. All the changes explained in this
document will only happen in case the user specifies <strong>(raw_data
== FALSE)</strong>.</p>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p><strong>1. Bind Global Variables:</strong> example from
<em>load_cempre()</em></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sidra_code</span> <span class="op">&lt;-</span> <span class="va">available_time</span> <span class="op">&lt;-</span> <span class="va">AMZ_LEGAL</span> <span class="op">&lt;-</span> <span class="va">municipio_codigo</span> <span class="op">&lt;-</span> <span class="va">ano</span> <span class="op">&lt;-</span> <span class="va">ano_codigo</span> <span class="op">&lt;-</span> <span class="va">classificacao_nacional_de_atividades_economicas_cnae_2_0_codigo</span> <span class="op">&lt;-</span> <span class="va">geo_id</span> <span class="op">&lt;-</span> <span class="va">id_code</span> <span class="op">&lt;-</span> <span class="va">nivel_territorial</span> <span class="op">&lt;-</span> <span class="va">nivel_territorial_codigo</span> <span class="op">&lt;-</span> <span class="va">valor</span> <span class="op">&lt;-</span> <span class="va">variavel</span> <span class="op">&lt;-</span> <span class="va">unidade_de_medida</span> <span class="op">&lt;-</span> <span class="va">unidade_de_medida_codigo</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
<p><strong>2. Define Basic Parameters:</strong> example from
<em>load_deter()</em></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># param=list()</span></span>
<span><span class="co">#  param$dataset = dataset</span></span>
<span><span class="co">#  param$time_period = time_period</span></span>
<span><span class="co">#  param$language = language</span></span>
<span><span class="co">#  param$raw_data = raw_data</span></span>
<span><span class="co">#  param$survey_name = datasets_link() %&gt;%</span></span>
<span><span class="co">#    dplyr::filter(dataset == param$dataset) %&gt;%</span></span>
<span><span class="co">#    dplyr::select(survey) %&gt;%</span></span>
<span><span class="co">#    unlist()</span></span>
<span><span class="co">#  param$url = datasets_link() %&gt;%</span></span>
<span><span class="co">#    dplyr::filter(dataset == param$dataset) %&gt;%</span></span>
<span><span class="co">#    dplyr::select(link) %&gt;%</span></span>
<span><span class="co">#    unlist()</span></span></code></pre></div>
<p><strong>3. Download Data:</strong> example from
<em>load_degrad()</em>. It uses the <em>external_download()</em>
function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># dat = suppressWarnings(as.list(param$time_period) %&gt;%</span></span>
<span><span class="co">#      purrr::map(</span></span>
<span><span class="co">#        function(t){external_download(dataset = param$dataset,</span></span>
<span><span class="co">#                                      source='degrad', year = t) %&gt;%</span></span>
<span><span class="co">#            janitor::clean_names()</span></span>
<span><span class="co">#        }</span></span>
<span><span class="co">#      ))</span></span></code></pre></div>
<p><strong>4. Data Engineering</strong>: example from
<em>load_pam()</em>. In this process, we decided to exclude some columns
and convert the variable “valor” to become numeric. After that we
excluded all the lines with <strong>NA</strong>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># dat = dat %&gt;%</span></span>
<span><span class="co">#           janitor::clean_names() %&gt;%</span></span>
<span><span class="co">#           dplyr::mutate_all(function(var){stringi::stri_trans_general(str=var,id="Latin-ASCII")})# %&gt;%</span></span>
<span>          <span class="co"># dplyr::mutate_all(clean_custom)</span></span>
<span><span class="co">#   dat = dat %&gt;%</span></span>
<span><span class="co">#     dplyr::select(-c(nivel_territorial_codigo,nivel_territorial,ano_codigo)) %&gt;%</span></span>
<span><span class="co">#     dplyr::mutate(valor=as.numeric(valor))</span></span>
<span><span class="co">#   dat = dat %&gt;%</span></span>
<span><span class="co">#     dplyr::filter(!is.na(valor))</span></span></code></pre></div>
<p><strong>5. Harmonizing Variable Names:</strong> example from
<em>load_pam()</em>. We localize some datasets by using their numerical
codes and within each of these datasets we renamed some columns.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># if (param$code == 5457){</span></span>
<span><span class="co">#     dat = dat %&gt;%</span></span>
<span><span class="co">#       dplyr::rename(produto_das_lavouras_codigo = produto_das_lavouras_temporarias_e_permanentes_codigo,</span></span>
<span><span class="co">#                     produto_das_lavouras = produto_das_lavouras_temporarias_e_permanentes)</span></span>
<span><span class="co">#   }</span></span>
<span><span class="co">#   if (param$code == 1613){</span></span>
<span><span class="co">#     dat = dat %&gt;%</span></span>
<span><span class="co">#       dplyr::rename(produto_das_lavouras_codigo = # produto_das_lavouras_permanentes_codigo,</span></span>
<span><span class="co">#                     produto_das_lavouras = produto_das_lavouras_permanentes)</span></span>
<span><span class="co">#   }</span></span>
<span><span class="co">#   if (param$code %in% c(839,1000,1001,1002,1612)){</span></span>
<span><span class="co">#     dat = dat %&gt;%</span></span>
<span><span class="co">#       dplyr::rename(produto_das_lavouras_codigo = # produto_das_lavouras_temporarias_codigo,</span></span>
<span><span class="co">#                   produto_das_lavouras = produto_das_lavouras_temporarias)</span></span>
<span><span class="co">#   }</span></span></code></pre></div>
<p><strong>6. Load Dictionary:</strong> example from
<em>load_pam()</em>. For functions with data from IBGE, we load the
dictionary and then we convert the variable “var_code” to become a
character. Finally we exclude the observations where var_code ==
“0”.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># dic = load_dictionary(param$dataset)</span></span>
<span><span class="co">#  types = as.character(dic$var_code)</span></span>
<span><span class="co">#  types = types[types != "0"] </span></span></code></pre></div>
<p><strong>7. Translation / add variables:</strong> example from
<em>load_degrad()</em>.This section translates the names of the columns
of the original Data Frame.In this example, the original columns
(variables) were in English and therefore we translated it to Portuguese
in case the user chooses it.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># if (param$language == 'pt'){</span></span>
<span><span class="co">#    dat_mod = dat %&gt;%</span></span>
<span><span class="co">#      dplyr::select(ano = year, linkcolumn, scene_id,</span></span>
<span><span class="co">#                    cod_uf = code_state, cod_municipio = code_muni,</span></span>
<span><span class="co">#                    classe = class_name, pathrow, area, data = view_date,</span></span>
<span><span class="co">#                    julday, geometry</span></span>
<span><span class="co">#      ) %&gt;%</span></span>
<span><span class="co">#      dplyr::arrange(ano, cod_municipio, classe)</span></span>
<span><span class="co">#  }</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Francisco de Lima Cavalcanti, DataZoom (PUC-Rio), Guilherme Jardim, Daniel AC Barbosa, Bruno Alcantara Duarte, Fredie Didier, Tito Bruni, Luiz Guilherme Lopes Moussatche, Victor Aliende da Matta, Anna Carolina Dutra Saraiva, Arthur Carvalho Brito, Igor Rigolon Veiga, Maria Mittelbach.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
